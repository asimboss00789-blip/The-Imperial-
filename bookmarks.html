<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bookmarks</title>
<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:#0d0d0d;color:#e0e0e0;}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#111;border-bottom:1px solid #333;}
header h1{margin:0;font-size:1.3rem;}
header button{padding:8px 12px;background:#5555ff;color:#fff;border:none;cursor:pointer;border-radius:4px;}
header button:hover{background:#7777ff;}
.content{padding:20px;}
.form-group{margin-bottom:12px;}
button{padding:10px 16px;border:none;background:#5465ff;color:#fff;cursor:pointer;border-radius:6px;}
button:hover{background:#6e84ff;}
.list{margin-top:20px;}
.item{padding:8px 12px;border:1px solid #444;margin-bottom:6px;border-radius:6px;}
/* overlay styles */
.overlay {
  position: fixed;
  top:0;
  right:0;
  bottom:0;
  width:50%;
  background: rgba(0,0,0,0.95);
  color:#e0e0e0;
  display:none;
  flex-direction:row;
  box-sizing:border-box;
}
.overlay .panel {
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  font-size:1.2rem;
  padding:20px;
}
.overlay .panel:hover {background:rgba(255,255,255,0.05);}
.overlay .close {
  position:absolute;
  top:10px;
  right:10px;
  cursor:pointer;
  font-size:1.5rem;
}
@media(max-width:600px){
  header h1{font-size:1.2rem;}
  /* overlay remains half width */
}
</style>
</head>
<body>
<header>
  <button id="menuBtn">☰</button>
  <h1>Bookmarks</h1>
</header>
<div class="content">
  <div class="search-section">
    <input type="text" id="searchInput" placeholder="Search manga / manhwa..." />
    <button id="searchBtn">Search</button>
    <a href="categories.html" style="margin-left:10px;color:#fff;">Manage Categories</a>
  </div>
  <div id="searchResults" class="list"></div>
  
  <hr style="margin:20px 0;border-color:#444;" />
  <h3>Your bookmarks</h3>
  <div>
    <label>Filter by category: </label>
    <select id="categoryFilter"><option value="">--all--</option></select>
  </div>
  <div id="bookmarksList" class="list"></div>
</div>
<div id="overlay" class="overlay">
  <span class="close" id="closeOverlay">&times;</span>
  <div class="panel" id="panelAI">AI Assistant</div>
  <div class="panel" id="panelBookmarks">Bookmarks</div>
</div>
<script>
// storage helpers
function loadBookmarks(){
  return JSON.parse(localStorage.getItem('bookmarks')||'[]');
}
function saveBookmarks(arr){
  localStorage.setItem('bookmarks',JSON.stringify(arr));
}
function loadCategories(){
  return JSON.parse(localStorage.getItem('categories')||'[]');
}
function saveCategories(arr){
  localStorage.setItem('categories',JSON.stringify(arr));
}

function addBookmark(item){
  const list = loadBookmarks();
  list.push(item);
  saveBookmarks(list);
  renderBookmarks();
}

function editBookmarkCategory(index,newCat){
  const list = loadBookmarks();
  if(list[index]){
    list[index].category=newCat;
    saveBookmarks(list);
    renderBookmarks();
  }
}
function renderBookmarks(filterCat){
  const list = loadBookmarks();
  const container = document.getElementById('bookmarksList');
  container.innerHTML='';
  const cats = new Set();
  list.forEach(b=>cats.add(b.category||''));  
  const filter = filterCat===undefined?document.getElementById('categoryFilter').value:filterCat;
  list.forEach((b,i)=>{
    if(filter && b.category!==filter) return;
    const div = document.createElement('div');
    div.className='item';
    div.innerHTML=`<strong>${b.title}</strong> ${b.category?`<em>(${b.category})</em>`:''}<br><a href="${b.url}" target="_blank">link</a> <button data-index="${i}" class="editBtn" style="margin-left:8px;">✎</button>`;
    container.appendChild(div);
  });
  const sel=document.getElementById('categoryFilter');
  sel.innerHTML='<option value="">--all--</option>';
  Array.from(cats).filter(c=>c).forEach(c=>{
    const opt=document.createElement('option');opt.value=c;opt.textContent=c;sel.appendChild(opt);
  });
  // attach edit handlers
  Array.from(document.getElementsByClassName('editBtn')).forEach(btn=>{
    btn.onclick = () => {
      const idx = btn.getAttribute('data-index');
      const newCat = prompt('New category (leave empty to remove):',loadBookmarks()[idx].category||'');
      editBookmarkCategory(idx,newCat);
    };
  });
}

// search using Jikan API
async function searchManga(query){
  const url = `https://api.jikan.moe/v4/manga?q=${encodeURIComponent(query)}&limit=10`;
  const res = await fetch(url);
  return res.json();
}

const searchBtn = document.getElementById('searchBtn');
const searchInput = document.getElementById('searchInput');
const resultsDiv = document.getElementById('searchResults');

searchBtn.onclick = async () => {
  const q = searchInput.value.trim();
  if(!q) return;
  resultsDiv.innerHTML = '<div class="loader"></div>';
  try{
    const data = await searchManga(q);
    resultsDiv.innerHTML = '';
    (data.data||[]).forEach(m=>{
      const div = document.createElement('div');
      div.className='item';
      const imgUrl = m.images && m.images.jpg && m.images.jpg.image_url;
      div.innerHTML = `<div style="display:flex;align-items:center;">
        ${imgUrl?`<img src="${imgUrl}" alt="${m.title}" width="80" style="margin-right:10px;" onerror="this.style.display='none'"/>`:''}
        <div><strong>${m.title}</strong><br><a href="${m.url}" target="_blank">view</a></div>
      </div>
      <button data-id="${m.mal_id}" style="margin-top:5px;">Bookmark</button>`;
      div.querySelector('button').onclick = () => {
        let cats = loadCategories();
        let cat = '';
        if(cats.length){
          cat = prompt('Enter category (or choose from: '+cats.join(', ')+')','');
        } else {
          cat = prompt('Enter category (optional):','');
        }
        addBookmark({ title:m.title, url:m.url, category:cat });
      };
      resultsDiv.appendChild(div);
    });
  }catch(e){
    resultsDiv.textContent='Search error: '+e.message;
  }
};

// filter change
document.getElementById('categoryFilter').onchange = () => renderBookmarks();

renderBookmarks();

// overlay handling (same as other pages)
const menuBtn2 = document.getElementById('menuBtn');
const overlay2 = document.getElementById('overlay');
const closeOverlay2 = document.getElementById('closeOverlay');
const panelAI2 = document.getElementById('panelAI');
const panelBookmarks2 = document.getElementById('panelBookmarks');
if(menuBtn2){
  menuBtn2.onclick = () => { overlay2.style.display = 'flex'; };
}
if(closeOverlay2){
  closeOverlay2.onclick = () => { overlay2.style.display = 'none'; };
}
if(panelAI2){ panelAI2.onclick = () => { window.location.href='ai.html'; } }
if(panelBookmarks2){ panelBookmarks2.onclick = () => { window.location.href='bookmarks.html'; } }
overlay2 && (overlay2.onclick = (e)=>{ if(e.target===overlay2) overlay2.style.display='none'; });
</script>
</body>
</html>