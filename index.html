<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beastguard AI</title>
<style>
/* RainChatify-inspired dark layout */
body {
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: #1a1a1a;
  color: #f0f0f0;
}
.chat-container {
  display:flex;
  flex-direction:column;
  height:100vh;
  max-width:600px;
  margin:auto;
  border:1px solid #333;
}
.chat-window {
  flex:1;
  overflow-y:auto;
  padding:10px;
}
.message {
  margin:5px 0;
  padding:10px;
  border-radius:10px;
  max-width:80%;
  word-wrap:break-word;
}
.user { background:#2a2a2a; align-self:flex-end;}
.beastguard { background:#4444aa; align-self:flex-start;}
.input-bar {
  display:flex;
  border-top:1px solid #333;
}
input[type="text"] {
  flex:1;
  padding:10px;
  border:none;
  background:#2a2a2a;
  color:#f0f0f0;
}
button {
  padding:10px;
  border:none;
  background:#5555ff;
  color:#fff;
  cursor:pointer;
}
button:hover { background:#7777ff; }
.file-bar {
  display:flex;
  padding:5px;
  border-bottom:1px solid #333;
}
.file-bar button {
  flex:1;
  margin:0 2px;
}
</style>
</head>
<body>

<div class="chat-container">
  <div class="file-bar">
    <button id="uploadFileBtn">Upload Knowledge File</button>
    <button id="exportMemoryBtn">Export Beastguard Memory</button>
  </div>
  <div id="chatWindow" class="chat-window"></div>
  <div class="input-bar">
    <input type="text" id="userInput" placeholder="Type your message...">
    <button id="sendBtn">Send</button>
  </div>
</div>

<input type="file" id="fileInput" style="display:none;">

<script>
// Beastguard memory in IndexedDB
let memory = [];
if(localStorage.getItem('beastguardMemory')) {
  memory = JSON.parse(localStorage.getItem('beastguardMemory'));
}

const chatWindow = document.getElementById('chatWindow');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const fileInput = document.getElementById('fileInput');

function addMessage(text, sender) {
  const div = document.createElement('div');
  div.className = 'message ' + sender;
  div.textContent = text;
  chatWindow.appendChild(div);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

// Simple AI logic: pulls from memory to respond
function beastguardReply(input) {
  // Simple matching: look for keywords in memory
  let reply = "Beastguard has pondered your words, but I need more context.";
  if(memory.length > 0) {
    for(let entry of memory) {
      if(entry.text.toLowerCase().includes(input.toLowerCase().split(' ')[0])) {
        reply = `From what I learned: "${entry.summary}"`;
        break;
      }
    }
  }
  // Reflection: store last input
  memory.push({text: input, summary: input});
  localStorage.setItem('beastguardMemory', JSON.stringify(memory));
  return reply;
}

sendBtn.onclick = () => {
  const text = userInput.value.trim();
  if(!text) return;
  addMessage(text, 'user');
  const reply = beastguardReply(text);
  addMessage(reply, 'beastguard');
  userInput.value = '';
}

// File upload and learning
document.getElementById('uploadFileBtn').onclick = () => fileInput.click();
fileInput.onchange = (e) => {
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    const text = reader.result;
    // Split into chunks to simulate learning
    const chunks = text.match(/(.|[\r\n]){1,500}/g);
    for(let chunk of chunks) {
      memory.push({text: chunk, summary: chunk.slice(0,100) + '...'});
    }
    localStorage.setItem('beastguardMemory', JSON.stringify(memory));
    addMessage(`Beastguard has absorbed ${file.name}`, 'beastguard');
  };
  reader.readAsText(file);
}

// Export memory
document.getElementById('exportMemoryBtn').onclick = () => {
  const blob = new Blob([JSON.stringify(memory, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'beastguard_memory.json';
  a.click();
  URL.revokeObjectURL(url);
  addMessage('Beastguard memory exported!', 'beastguard');
}

</script>
</body>
</html>
